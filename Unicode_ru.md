### Unicode и его кодировки UTF-8 и UTF-16
Чтобы представлять буквы, знаки препинания и другие символы в памяти компьютера (и потом, например, передавать их через Интернет), нужно сначала перевести их в цифровой вид. Для этого существуют системы кодирования символов, которые задают свой цифровой код для каждого кодируемого символа (необходимо отметить, что «символы» в этом контексте не всегда соответствуют символам в человеческом понимании и включают, например, управляющие символы, такие как табуляция или перевод строки).

**Юникод** (Unicode) – это универсальная система кодирования, создана и поддерживается некоммерческой организацией «Консорциум Юникода». Юникод официально называется Международный Стандарт Юникод (Unicode Worldwide Character Standard) и является не отдельной кодировкой, а стандартом, который включает в себя набор символов и семейство кодировок для этого набора.

Набор символов стандарта Юникод называется **UCS** (Universal Character Set, универсальный набор символов). Он присваивает символам цифровые коды, которые записываются как U+[шестнадцатеричный код] и называются _кодовыми точками_. Кодовое пространство Юникода (т.е. разрешённые стандартом кодовые точки) состоит из кодовых точек от 0 до 10FFFF. Набор символов Юникода включает символы всех основных систем письменности, а также технических символьных систем и некоторые другие символы, например, эмодзи. На настоящий момент в стандарте Юникод представлено 150 систем письменности, а общее количество символов приближается к 150 000. В этом его преимущество перед другими системами кодирования, которые охватывают гораздо меньшее количество символов (обычно только латиницу плюс национальный алфавит или какую-либо специализированную символьную систему). Благодаря этому Юникод сейчас принят во всём современном ПО.

Коды UCS представляют собой просто договорённость о том, какой код соответствует какому символу, которая не определяет способ представления этих кодов в памяти или в файле. Машинное представление кодов UCS определяется кодировками UTF (Unicode Transformation Format, формат трансформации Юникода).

Когда говорят о кодировках UTF, обычно имеют ввиду три входящих в стандарт Юникод **формы представления: UTF-8, UTF-16, UTF-32**. Но нужно отметить, что аббревиатура UTF может относиться также к схемам кодирования, которые представляют собой форму представления плюс указание на порядок байтов или отсутствие такого указания: например, форме представления UTF-16 соответствуют три схемы кодирования – UTF-16 (без явного указания на порядок байтов), UTF-16LE (little-endian, прямой порядок байтов) и UTF-16BE (big-endian, обратный порядок байтов).

Формы представления работают с _кодовыми элементами_ – наборами бит фиксированного размера, комбинации которых используются для представления UCS-кодов в машиночитаемом виде. Формы представления задают уникальные последовательности кодовых элементов для кодовых точек U+0000..U+D7FF и U+E000..U+10FFFF (Диапазон U+D800…U+DFFF зарезервирован для создания суррогатных пар в UTF-16, про это ниже).

Они все кодируют один и тот же набор символов (UCS), но представляют эти символы как разные последовательности байтов и по-разному распределяют **количество байтов для представления символа**.

Для начала, у разных форм представления разный размер кодовых элементов, соответствующий числу в названии кодировки: UTF-**_8_** работает с элементами размером в 1 байт (**_8_** бит), а UTF-**_16_**, соответственно, с элементами размером в 2 байта (**_16_** бит).

Таблица 1. Размер кодовых элементов

| UTF-8  | UTF-16  |
|:------:|:------:|
|1 байт|2 байта|

При этом обе эти кодировки являются кодировками с переменной длинной, то есть эти размеры элементов не значат, что каждый символ занимает столько байтов.

* **UTF-8** использует один элемент (=один байт) для кодовых точек U+0000…U+007F – это первый блок стандарта Юникод, «Основная латиница», он содержит строчные и заглавные латинские буквы, а также цифры, пунктуацию и управляющие символы. Поэтому UTF-8 особенно эффективна для текстов на английском и других языках, использующих латинскую письменность, так как почти все символы текста на таком языке будут занимать в UTF-8 один байт. Но кодовые точки после U+007F используют 2, 3 или 4 элемента (=байта).

* В **UTF-16** точки U+0000..U+D7FF и U+E000..U+FFFF занимают по одному элементу, то есть по 2 байта. Эти точки соответствуют базовой многоязыковой плоскости (Basic Multilingual Plane, BMP), которая содержит наиболее часто используемые символы. Остальные, менее частотные точки U+10000..U+10FFFF представляются с помощью так называемых «суррогатных пар» из двух элементов и занимают, соответственно, по 4 байта. Для суррогатных пар используются вышеупомянутые зарезервированные точки U+D800…U+DFFF: суррогатная пара состоит из высокого суррогата из диапазона U+D800…U+DBFF и следующего за ним низкого суррогата из диапазона U+DC00…U+DFFF. Точки из этих диапазонов не могут быть использованы по отдельности.

Таблица 2. Количество байтов для представления символа

| UTF-8  | UTF-16  |
|:------:|:------:|
|1-4|2 или 4|

Например, символ с UCS-кодом _U+0061_ (строчная латинская «a») в UTF-8 будет закодирован одним байтом как _61_ (_0110000_), а в UTF-16 двумя байтами как _0061_. А символ с более сложным кодом _U+1D11E_ (скрипичный ключ «&#119070;») закодирован в UTF-8 как _F0 9D 84 9E_ (_11110000:10011101:10000100:10011110_), все 4 байта, а в UTF-16 как суррогатная пара _D834 DD1E_ (высокий суррогат _U+D834_ и низкий суррогат _U+DD1E_), тоже 4 байта.

Очевидно, что UTF-8 более эффективна, так как, за счёт меньшего размера элементов, в большинстве случаев требует меньше памяти. Однако это зависит от системы письменности, и в некоторых случаях, например, для китайского или для нотной записи, UTF-8 начинает использовать 3-4 байта для более сложных символов и требует больше памяти, чем UTF-16, которая по факту использует 2 байта для большинства обычно используемых символов.

Ещё одно преимущество UTF-8 в том, что символы блока «Основная латиница», закодированные в UTF-8 одним байтом, соотносятся с символами ASCII с соответствующими кодами 1:1. То есть UTF-8 **обратно совместима с ASCII**: если файл в UTF-8 содержит только символы ASCII, то он закодирован полностью так же, как аналогичный ASCII-файл. На практике это значит, в частности, что UTF-8 удобнее для обновления устаревших приложений.

Таблица 3. Обратная совместимость с ASCII

| UTF-8  | UTF-16  |
|:------:|:------:|
|да|нет|

**UTF-8** преобладающе используется **для веб-страниц** и вообще является наиболее распространённой кодировкой Юникода (благодаря её перечисленным выше преимуществам), но **UTF-16** используется **как внутреннее представление** Юникода во многих языках программирования (Java, C#, JavaScript), а также в операционных системах, в частности в Windows (но Linux, например, в большинстве случаев использует UTF-8). Так сложилось по ряду причин, в частности просто потому, что на UTF-16 было проще переходить с более ранних кодировок Юникода с тоже двухбайтными элементами.

Таблица 4. Где преобладающе используется

| UTF-8  | UTF-16  |
|:------:|:------:|
|Веб-страницы|Языки программирования и операционные системы|

На практике это иногда делает UTF-16 удобнее просто за счёт того, что она принята на платформе или в языке программирования, с которыми идёт работа. 